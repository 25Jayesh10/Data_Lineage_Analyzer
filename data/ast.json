[
  {
    "proc_name": "log_hr_employees",
    "params": [],
    "return_type": "VOID",
    "variables": [
      {
        "name": "@emp_id",
        "type": "INT"
      },
      {
        "name": "@emp_name",
        "type": "VARCHAR"
      }
    ],
    "statements": [
      {
        "type": "DECLARE_CURSOR",
        "cursor_name": "emp_cursor",
        "select_statement": {
          "type": "SELECT",
          "columns": [
            "emp_id",
            "emp_name"
          ],
          "from": "employees",
          "where": {
            "type": "RAW_EXPRESSION",
            "expression": "department = 'HR'"
          }
        }
      },
      {
        "type": "OPEN_CURSOR",
        "cursor_name": "emp_cursor"
      },
      {
        "type": "FETCH_CURSOR",
        "cursor_name": "emp_cursor",
        "fetch_into": [
          "@emp_id",
          "@emp_name"
        ]
      },
      {
        "type": "WHILE",
        "condition": {
          "type": "RAW_EXPRESSION",
          "expression": "@@sqlstatus = 0"
        },
        "body": [
          {
            "type": "INSERT",
            "table": "employee_log",
            "columns": [
              "emp_id",
              "emp_name",
              "log_time"
            ],
            "values": [
              "@emp_id",
              "@emp_name",
              {
                "type": "RAW_EXPRESSION",
                "expression": "GETDATE()"
              }
            ]
          },
          {
            "type": "FETCH_CURSOR",
            "cursor_name": "emp_cursor",
            "fetch_into": [
              "@emp_id",
              "@emp_name"
            ]
          }
        ]
      },
      {
        "type": "CLOSE_CURSOR",
        "cursor_name": "emp_cursor"
      },
      {
        "type": "DEALLOCATE_CURSOR",
        "cursor_name": "emp_cursor"
      }
    ]
  }
]
